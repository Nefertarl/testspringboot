<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>新增文档 - 光年(Light Year Admin)后台管理系统模板</title>
<link rel="icon" href="../favicon.ico" type="image/ico">
<meta name="keywords" content="LightYear,光年,后台模板,后台管理系统,光年HTML模板">
<meta name="description" content="LightYear是一个基于Bootstrap v3.3.7的后台管理系统的HTML模板。">
<meta name="author" content="yinqi">
<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
<link th:href="@{/css/materialdesignicons.min.css}" rel="stylesheet">
<!--标签插件-->
<link rel="stylesheet" th:href="@{/js/jquery-tags-input/jquery.tagsinput.min.css}">
<link th:href="@{/css/style.min.css}" rel="stylesheet">
</head>

<body>
<div class="container-fluid">

  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">

          <form id="myForm" onsubmit="return checkForm()" method="post" enctype="multipart/form-data" class="row">
            <div class="form-group col-md-12">
              <label for="name">账号</label>
              <div class="form-controls">
                <input type="text" class="form-control" name="account" id="name" onblur="checkAccount()" value="" placeholder="请输入用户名" />
              </div>
            </div>

            <div class="form-group col-md-12">
              <label for="seo_keywords">密码</label>
              <input type="text" class="form-control" id="password" name="password" value="" placeholder="密码" />
            </div>

            <div class="form-group col-md-12">
              <label for="seo_keywords">确认密码</label>
              <input type="password" class="form-control" id="seo_keywords" name="re_password" value="" placeholder="确认密码" />
            </div>

            <div class="form-group col-md-12">
              <label for="title">姓名</label>
              <input type="text" class="form-control" id="title" name="name" value="" placeholder="姓名" />
            </div>

            <div class="form-group col-md-12">
              <label for="phone">手机</label>
              <input class="form-control" id="phone" name="phone" value="" placeholder="手机号"></input>
            </div>
            <div class="form-group col-md-12">
              <label for="email">邮箱</label>
              <input class="form-control" id="email" name="email"  value="" placeholder="邮箱"></input>
            </div>

            <div class="form-group col-md-12">
              <label for="sex">性别</label>
              <div class="clearfix">
                <label class="lyear-radio radio-inline radio-primary">
                  <input type="radio" name="sex" value="0" checked><span>女</span>
                </label>
                <label class="lyear-radio radio-inline radio-primary">
                  <input type="radio" name="sex" value="1" ><span>男</span>
                </label>
              </div>
            </div>


            <div class="form-group col-md-12">
              <label>头像</label>
              <div class="form-controls">

                <ul class="list-inline clearfix lyear-uploads-pic">
                  <li class="col-xs-4 col-sm-3 col-md-2">
                    <figure>
                      <img th:src="@{/images/gallery/15.jpg}" alt="图片一" id="MyImg">
                      <figcaption>
                        <a class="btn btn-round btn-square btn-primary" href="#!"><i class="mdi mdi-eye"></i></a>
                        <a class="btn btn-round btn-square btn-danger" href="#!"><i class="mdi mdi-delete"></i></a>
                      </figcaption>
                    </figure>
                  </li>
                  <li class="col-xs-4 col-sm-3 col-md-2">
<!--                    name名不能跟属性一样-->
                    <input id="myHead" name="myHead" onchange="changeHead(this)" type="file" style="display: none"  />
                    <a class="pic-add" onclick="ClickBtn()" id="add-pic-btn" href="#!" title="点击上传"></a>
                  </li>
                </ul>
              </div>
            </div>



            <div class="form-group col-md-12">
              <button type="button" onclick="executeAjax()" class="btn btn-primary ajax-post" target-form="add-form">注 册</button>
            </div>
          </form>

        </div>
      </div>
    </div>

  </div>

</div>

<script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/js/perfect-scrollbar.min.js}"></script>
<!--标签插件-->
<script th:src="@{/js/jquery-tags-input/jquery.tagsinput.min.js}"></script>
<script type="text/javascript" th:src="@{/js/main.min.js}"></script>
<!--消息提示-->
<script th:src="@{/js/bootstrap-notify.min.js}"></script>
<script th:src="@{/js/lightyear.js}"></script>
<script th:src="@{/js/main.min.js}"></script>
<link th:href="@{/css/animate.css}" rel="stylesheet">
<script>

  function executeAjax() {
    var account = document.getElementById("name").value;
    var password = document.getElementById("password").value;
    var name = document.getElementById("title").value;
    var phone = document.getElementById("phone").value;
    var email = document.getElementById("email").value;

      //    data中传递json对象
      $.ajax({
        url: '/testspringboot/user/addUser',
        type: 'post',
        async: true,
        data: {
          account,
          password,
          name,
          phone,
          email
        },
        dataType: 'json',
        success: function (data) {
          console.log(data)
          if (data.code== 20000){
            window.location.href="/testspringboot/toHome";
          }else{
            if(data.data.error){
              lightyear.loading('show');
              setTimeout(function() {
                lightyear.loading('hide');
                lightyear.notify(data.data.error, 'danger', 100);
              }, 0)
            }
            document.getElementById("captcha").src=document.getElementById("captcha").src+'?d='+Math.random();
            document.getElementById("password").value="";
            document.getElementById("code").value="";
          }
        },
        error: function () {
          console.log('因为网络的一些原因,给你造成不便,敬请谅解.......')
        }
      })
  }

  function ClickBtn() {
    //获取文件组件对象触发单击事件
    document.getElementById("myHead").click();
  }
  function changeHead(obj) {
    var myFile = obj.files[0];
    var src= window.URL.createObjectURL(myFile);
    document.getElementById("MyImg").setAttribute("src",src);
  }

  var flag = true;
  //验证表单-----------------------
  function checkForm(){
    //验证账号
    var account = document.getElementById("name").value;
    if (account=="" || account==null) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('账号不能为空', 'danger', 100);
      }, 1e3)
      return false;
    }
    var reg=/^[\u4E00-\u9FA5A-Za-z0-9_]+$/;
    if (!reg.test(account)) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('账号只能是字母和数字中文_构成', 'danger', 100);
      }, 1e3)
      return false;
    }

    if(!flag){
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('账号已注册!', 'danger', 100);
      }, 1e3)
      return false;
    }
    //验证姓名--------------------
    var title = document.getElementById("title").value;
    if (title=="" || title==null) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('姓名不能为空', 'danger', 100);
      }, 1e3)
      return false;
    }
    var reg=/^[\u4E00-\u9FA5A-Za-z]+$/;
    if (!reg.test(title)) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('姓名只能是字母和中文构成', 'danger', 100);
      }, 1e3)
      return false;
    }
    //验证密码----------------------
    var password = document.getElementById("password").value;
    if (password=="" || password==null) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('密码不能为空', 'danger', 100);
      }, 1e3)
      return false;
    }
    //验证确认密码----------------------
    var seo_keywords = document.getElementById("seo_keywords").value;
    if (seo_keywords=="" || seo_keywords==null) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('确认密码不能为空', 'danger', 100);
      }, 1e3)
      return false;
    }
    //验证密码和确认密码不一致----------------------
    if (password!=seo_keywords) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('密码和确认密码不一致', 'danger', 100);
      }, 1e3)
      return false;
    }
    //验证手机号码不一致----------------------
    var phone = document.getElementById("phone").value;
    if (phone=="" || phone==null) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('手机号不能为空', 'danger', 100);
      }, 1e3)
      return false;
    }

    var phoneT=/^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d{8}$/;
    if (!phoneT.test(phone)) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('手机号格式不正确', 'danger', 100);
      }, 1e3)
      return false;
    }
    //验证邮箱不一致----------------------
    var email = document.getElementById("email").value;
    if (email=="" || email==null) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('邮箱不能为空', 'danger', 100);
      }, 1e3)
      return false;
    }

    var reg2=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
    if (!reg2.test(email)) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('邮箱格式不正确', 'danger', 100);
      }, 1e3)
      return false;
    }

    //上传头像验证
    var myHead = document.getElementById("myHead").value;
    if (myHead.length<1) {
      lightyear.loading('show');
      // 假设ajax提交操作
      setTimeout(function() {
        lightyear.loading('hide');
        lightyear.notify('头像不能为空', 'danger', 100);
      }, 1e3)
      return false;
    }

    return true;
  }


  //验证账号是否可用
  function checkAccount(){
    var account = document.getElementById("name").value;
    $.post('/testspringboot/user/checkAccount?account='+account,function (result) {
      if (result=="账号可用"){
        lightyear.loading('show');
        setTimeout(function() {
          lightyear.loading('hide');
          lightyear.notify('账号可用', 'success', 100);
        }, 1e3)
        flag = true;
      }else {
        lightyear.loading('show');
        setTimeout(function() {
          lightyear.loading('hide');
          lightyear.notify('账号已注册!', 'danger', 100);
        }, 1e3)
        flag = false;
      }
    });
  }

</script>
</body>
</html>